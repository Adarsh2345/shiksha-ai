
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Allow unauthenticated access for developer scripts
    match /students/{studentId} {
        allow list, create: if true;
        allow get: if request.auth != null;
        // Allow delete only if the resource is dev generated
        allow delete: if resource.data.dev_generated == true;
        // No updates allowed by users for now
        allow update: if false;
    }

    match /teachers/{teacherId} {
        allow list, create: if true;
        allow get: if request.auth != null;
        allow update: if request.auth.uid == teacherId;
        // Allow delete only if the resource is dev generated
        allow delete: if resource.data.dev_generated == true;
    }

    match /classrooms/{classroomId} {
      allow get: if request.auth != null;
      allow create, update: if true; // For admin scripts
      match /posts/{postId} {
        allow read, create: if request.auth != null;
        allow delete: if request.auth.uid == resource.data.authorId;
      }
    }
    
    match /lessonPlans/{planId} {
      allow read, create: if request.auth != null;
      allow update: if request.auth.uid == resource.data.authorId;
    }

    match /worksheets/{worksheetId} {
      allow read, create: if request.auth != null;
    }
  }
}
